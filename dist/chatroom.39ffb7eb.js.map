{"version":3,"sources":["js/chatroom.js"],"names":["stompClient","txtMensaje","document","getElementById","value","textArea","divPrivados","escribiendoText","email","socio","localStorage","$","ready","connect","addEventListener","cerrarSesion","sendPublicMessage","sendPrivMessage","socket","SockJS","Stomp","over","onConnected","subscribe","mensaje","mostrarMensajePublico","JSON","parse","body","send","listaMensajes","mostrarHistorial","console","log","mostrarMensajePrivado","Date","getTime","stringify","socioReceptor","innerHTML","nombre","apellido","texto","fecha","replace","substring","forEach","disconnect","clear","window","location","href"],"mappings":"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","file":"chatroom.39ffb7eb.js","sourceRoot":"..\\src","sourcesContent":["var stompClient = null;\r\nconst txtMensaje = document.getElementById('mensaje').value;\r\nconst textArea = document.getElementById('chat-textos');\r\nconst divPrivados = document.getElementById('mensajes-privados');\r\nconst escribiendoText = document.getElementById('escribiendoText');\r\nconst email = document.getElementById('txt-email-socio').value;\r\nconst socio = {\r\n    'email': localStorage.email\r\n};\r\n\r\n$(document).ready(function() {\r\n    connect();\r\n  });\r\ndocument.getElementById(\"btnCerrarSesion\").addEventListener(\"click\", cerrarSesion);\r\ndocument.getElementById(\"btnEnviarPublico\").addEventListener(\"click\", sendPublicMessage);\r\ndocument.getElementById(\"btnEnviarPrivado\").addEventListener(\"click\", sendPrivMessage);\r\n\r\nfunction connect(){\r\n    var socket = new SockJS('http://localhost:8080/chat-websocket');\r\n    stompClient = Stomp.over(socket);\r\n    stompClient.connect({}, onConnected);\r\n}\r\n\r\nfunction onConnected() {\r\n    stompClient.subscribe('/chat/publico', function(mensaje){\r\n        mostrarMensajePublico(JSON.parse(mensaje.body));\r\n    });\r\n\r\n    stompClient.send(\"/app/historial\", {}, localStorage.email);\r\n\r\n    stompClient.subscribe('/chat/historial/'+localStorage.email, function(listaMensajes){\r\n        mostrarHistorial(JSON.parse(listaMensajes.body));\r\n        console.log(JSON.parse(listaMensajes.body));\r\n    });\r\n\r\n    stompClient.subscribe('/chat/'+ localStorage.email +'/private', function(mensaje){\r\n        mostrarMensajePrivado(JSON.parse(mensaje.body));\r\n    });\r\n}\r\n\r\nfunction sendPublicMessage(){\r\n    var mensaje = {\r\n        'id': 'id-' + new Date().getTime(),\r\n        'texto': document.getElementById('mensaje').value,\r\n        'socio': socio\r\n    }\r\n    stompClient.send(\"/app/mensaje-publico\", {}, JSON.stringify(mensaje));\r\n}\r\n\r\nfunction sendPrivMessage(){\r\n    const socioReceptor = {\r\n        'email': document.getElementById('listado-emails').value\r\n    };\r\n    var mensaje = {\r\n        'id': 'id-' + new Date().getTime(),\r\n        'texto': document.getElementById('privMensaje').value,\r\n        'socio': socio,\r\n        'receptor': socioReceptor\r\n    }\r\n    stompClient.send(\"/app/mensaje-privado\", {}, JSON.stringify(mensaje));\r\n}\r\n\r\nfunction mostrarMensajePublico(mensaje){\r\n    textArea.innerHTML += '<div class=\"alert alert-info mx-3\" role=\"alert\"><h6>'+ mensaje.socio.nombre + ' ' +  mensaje.socio.apellido +'</h6>'+ mensaje.texto +'<small class=\"float-right\">'+ mensaje.fecha.replace('T', ' ').substring(0,19) +'</small></div>'\r\n}\r\n\r\nfunction mostrarMensajePrivado(mensaje){\r\n    divPrivados.innerHTML += '<div class=\"alert alert-success alert-dismissible fade show mt-3\" role=\"alert\"><strong>'+ mensaje.socio.email +'</strong>: '+ mensaje.texto +'<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></div>';\r\n}\r\n\r\nfunction mostrarHistorial(listaMensajes){\r\n    listaMensajes.forEach(mensaje => {\r\n        textArea.innerHTML += '<div class=\"alert alert-info mx-3\" role=\"alert\"><h6>'+ mensaje.socio.nombre + ' ' +  mensaje.socio.apellido +'</h6>'+ mensaje.texto +'<small class=\"float-right\">'+ mensaje.fecha.replace('T', ' ').substring(0,19) +'</small></div>'\r\n    });\r\n}\r\n\r\nfunction cerrarSesion(){\r\n    stompClient.disconnect();\r\n    localStorage.clear();\r\n    window.location.href = \"login.html\";\r\n}"]}